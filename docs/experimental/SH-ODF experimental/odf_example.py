import os

import numpy as np
from dipy.data.fetcher import dipy_home
from dipy.io.image import load_nifti

from fury import actor, window

if __name__ == "__main__":
    show_man = window.ShowManager(size=(1280, 720))

    dataset_dir = os.path.join(dipy_home, "stanford_hardi")

    coeffs, affine = load_nifti("docs\experimental\SH-ODF experimental\coefs_odf.nii")

    valid_mask = np.abs(coeffs).max(axis=(-1)) > 0
    indices = np.nonzero(valid_mask)

    centers = np.asarray(indices).T

    x, y, z, s = coeffs.shape
    coeffs = coeffs[:, :, :].reshape((x * y * z, s))
    
    #'''
    coeffs = np.array([
        [
            -0.2739740312099, 0.2526670396328, 1.8922271728516, 0.2878578901291,
            -0.5339795947075, -0.2620058953762, 0.1580424904823, 0.0329004973173,
            -0.1322413831949, -0.1332057565451, 1.0894461870193, -0.6319401264191,
            -0.0416776277125, -1.0772529840469,  0.1423762738705, 0.7941166162491,
            0.7490307092667, -0.3428381681442, 0.1024847552180, -0.0219132602215,
            0.0499043911695, 0.2162453681231, 0.0921059995890, -0.2611238956451,
            0.2549301385880, -0.4534865319729, 0.1922748684883, -0.6200597286224,
            -0.0532187558711, -0.3569841980934, 0.0293972902000, -0.1977960765362,
            -0.1058669015765, 0.2372217923403, -0.1856198310852, -0.3373193442822,
            -0.0750469490886, 0.2146576642990, -0.0490148440003, 0.1288588196039,
            0.3173974752426, 0.1990085393190, -0.1736343950033, -0.0482443645597,
            0.1749017387629, -0.0151847425660, 0.0418366046081, 0.0863263587216,
            -0.0649211244490, 0.0126096132283, 0.0545089217982, -0.0275142164626,
            0.0399986574832, -0.0468244261610, -0.1292105653111, -0.0786858322658,
            -0.0663828464882, 0.0382439706831, -0.0041550330365, -0.0502800566338,
            -0.0732471630735, 0.0181751900972, -0.0090119333757, -0.0604443282359,
            -0.1469985252752, -0.0534046899715, -0.0896672753415, -0.0130841364808,
            -0.0112942893801, 0.0272257498541, 0.0626717616331, -0.0222197983050,
            -0.0018541504308, -0.1653251944056, 0.0409697402846, 0.0749921454327,
            -0.0282830872616, 0.0006909458525, 0.0625599842287, 0.0812529816082,
            0.0914693020772, -0.1197222726745, 0.0376277453183, -0.0832617004142,
            -0.0482175038043, -0.0839003635737, -0.0349423908400,  0.1204519568256,
            0.0783745984003, 0.0297401205976, -0.0505947662525
        ]
    ])
    centers= np.array([0, 0, 0])
    #'''

    odf_actor = actor.odf(centers=centers, coeffs=coeffs, scales=1.0, 
                          basis_type='descoteaux', degree=6)
    show_man.scene.add(odf_actor)
    show_man.start()